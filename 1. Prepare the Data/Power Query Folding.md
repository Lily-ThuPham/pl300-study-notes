#### **Key Concepts üí°**

**Query Folding** is the process where Power Query translates the transformations you apply in the Power Query Editor (like filtering, renaming, grouping) into a single, native query language that the data source can understand and execute. This process "folds" multiple transformation steps into one operation.

Instead of your machine downloading an entire table and then applying transformations, the data source itself does the heavy lifting of filtering and transforming the data _before_ sending the much smaller, final result to Power BI. This dramatically improves performance and reduces the load on your computer and network.

**Query folding does not happen for all data sources.** It is primarily supported by sources that have their own query language and processing engine, such as relational databases (SQL Server, Oracle), OData feeds, and Exchange. It is **not** supported for flat files like CSV, Excel, or text files.
##### **Benefits of query folding**
- **More efficiency in data refreshes and incremental refreshes.**¬†When you import data tables by using query folding, Power BI is better able to allocate resources and refresh the data faster because Power BI doesn't have to run through each transformation locally.
- **Automatic compatibility with DirectQuery and Dual storage modes.**¬†All DirectQuery and Dual storage mode data sources must have the back-end server processing abilities to create a direct connection, which means that query folding is an automatic capability that you can use. 
---
#### **Definitions of Important Terms**
| Term                  | Definition                                                                                           | Relevance to Query Folding                                                                               |
| --------------------- | ---------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------- |
| **Mashup Engine**     | The core processing engine of Power Query that handles data transformations.                         | When folding fails, this engine does all the work locally on your machine, which can be slow.            |
| **Data Source Query** | The native query (e.g., a single SQL statement) that Power Query sends to the data source.           | This is the "folded" query. If this can be generated, folding is successful.                             |
| **Query Plan**        | A detailed set of instructions that the mashup engine creates to execute all transformations.        | The plan determines which steps can be folded and which cannot, optimizing the execution path.           |
| **Query Diagnostics** | A tool in Power Query used to trace and understand how each transformation step is being evaluated.  | It provides a detailed, step-by-step report showing exactly where folding stops.                         |
| **Value.Firewall**    | A special M language function related to Power Query's data privacy firewall.                        | Its appearance in diagnostics often indicates a barrier that has broken the query folding process.       |
| **Privacy Levels**    | Data source settings (Public, Organizational, Private) used to prevent data leakage between sources. | If sources in a query have incompatible privacy levels, it can break folding and force local processing. |

--- 
#### **How to Check for Query Folding**
1. **"View Native Query" Option:** In the **Applied Steps** pane, right-click on a step. If the **View Native Query** option is enabled (not grayed out), that step and all preceding steps have been folded. If it's grayed out, that step broke the folding process and is likely the cause of the poor performance if any. 
2. **Query Diagnostics:** For a more detailed, step-by-step analysis, use the **Query Diagnostics** tool (under the _Tools_ tab). After running a diagnostic, you can analyze the results to see which steps have a "Data Source Query" column filled in‚Äîthis indicates those steps were successfully folded.
##### Native queries aren't possible for the following transformations:
- Adding an index column
- Merging and appending columns of different tables with two different sources
- Changing the data type of a column

---
#### **Sample Exam Questions üìù**

| No. | Question                                                                                                                                                                                                                                                                                   | Options                                                                                                                                                                                                                                                                               | Explanation                                                                                                                                                                                                                                                                                                                                            |
| --- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| 1   | You are sourcing data from a SQL Server database. In the Power Query Editor, you apply several steps: filtering rows, removing columns, and renaming columns. After applying the final step, you notice the "View Native Query" option is grayed out. What is the most likely implication? | A. The data will refresh faster.<br>**==B. The mashup engine will process all transformations locally.==**<br>C. A native SQL query was successfully generated for all steps.<br>D. The data source does not support query folding.                                                   | If "View Native Query" is grayed out, it signifies that the last applied step (or a previous one) could not be translated into SQL, breaking the query folding process. Consequently, the Power Query mashup engine must download the data from the last foldable step and perform the remaining transformations on your machine.                      |
| 2   | Which of the following data sources fully supports query folding?                                                                                                                                                                                                                          | A. A CSV file stored in a local folder.<br>B. An Excel workbook stored in SharePoint.<br>C. A JSON file from a web API.<br>**==D. An OData feed.==**                                                                                                                                  | OData feeds, like relational databases, have a standardized query syntax that allows Power Query to fold transformations back to the source. Flat files like CSV, Excel, and typically JSON do not have an underlying query engine, so folding is not possible.                                                                                        |
| 3   | You are using Query Diagnostics to optimize a slow-running query. In the diagnostics output, you see that the "Data Source Query" column is populated for the first five steps, but is empty for the sixth step, "Added Custom Column." What does this indicate?                           | A. The entire query failed to fold.<br>B. The custom column logic was successfully translated into the native query language.<br>**==C. Query folding stopped at the fifth step.==**<br>D. Query Diagnostics is not configured correctly.                                             | **_The presence of a value in the "Data Source Query" column confirms that a step was folded._** When this column becomes empty, it marks the exact point where folding stopped. Adding a custom column with complex M language functions that have no direct equivalent in the source's language is a common reason for breaking folding.             |
| 4   | A Power BI data refresh is taking a very long time. The data is sourced from an on-premises Oracle database. You suspect a query folding issue. What is the most effective first step to confirm your suspicion within Power BI Desktop?                                                   | A. Check the data privacy settings for the Oracle source.<br>B. Upgrade your Power BI Desktop version.<br>==**C. In Power Query, right-click the last step in the Applied Steps pane and check if "View Native Query" is active.**==<br>D. Increase the memory on your local machine. | This is the quickest and most direct way to check if folding is occurring for the entire query. If "View Native Query" is grayed out, it's a clear indicator that folding has been broken and is likely the cause of the poor performance. While other options might be relevant for performance, this step specifically diagnoses the folding status. |
